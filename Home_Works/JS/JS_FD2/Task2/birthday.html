<!DOCTYPE html>
<html lang="ru">
  <head>
      <meta charset=utf-8>
      <title>Practical task №23 (storage)</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <style>
        body {
          font-family: Verdana, Geneva, Tahoma, sans-serif;
        }
        .timer {
          margin: 0 auto;
          border: 5px red solid;
          border-radius: 10px;
          width: 70%;
          padding: 20px;
          font-size: 24px;
          text-align: center;
        }
        .hello {
          margin: 20px auto;
          text-align: center;
          font-size: 50px;
        }
      </style>
    </head>
    <body>
      <script>
        'use strict';

        if (localStorage.user) {
          const user = JSON.parse(localStorage.getItem('user'));
          document.body.innerHTML = `<h1 class="hello">Добрый день, ${user.userName}!</h1>`;
   
          const divInfo = document.createElement('div');
          divInfo.classList.add('timer');
          document.body.append(divInfo);
          
          function getTime(timeBirthday) {
            const timestamp = Date.parse(timeBirthday) - Date.parse(new Date());
            const months = Math.floor(timestamp / 1000 / 60 / 60 / 24 / 30);
            const days = Math.floor(timestamp / 1000 / 60 / 60 / 24 % 30);
            const hours = Math.floor(timestamp / 1000 / 60 / 60 % 24);
            const minutes = Math.floor((timestamp / 1000 / 60) % 60);
            const seconds = Math.floor((timestamp / 1000) % 60);
            return {
              total: timestamp,
              months: months,
              days: days,
              hours: hours,
              minutes: minutes,
              seconds: seconds,
            };
          }
          
          const timer = setInterval(checkAndShowInfo, 1000);
          checkAndShowInfo();

          function checkAndShowInfo() {
            const timestamp = getTime(user.userBirthday);
            
            if (timestamp.total <= 0) {
              clearInterval(timer);
              divInfo.innerHTML = `Поздравляю с наступившим днём рождения, ${user.userName}!`;

            } else {
              divInfo.innerHTML = 'До Вашего дня рождения осталось:<br>' +
              'месяцев: ' + timestamp.months + '<br>' +
              'дней: ' + timestamp.days + '<br>' +
              'часов: ' + timestamp.hours + '<br>' +
              'минут: ' + timestamp.minutes + '<br>' +
              'секунд: ' + timestamp.seconds;
            } 
          }

        } else {
          const user = {};
          user.userName = prompt('Введите Ваше имя');
          user.userBirthday = prompt('Введите будущую ближайшую дату Вашего дня рождения в формате ГГГГ-ММ-ДД');
          
          localStorage.setItem('user', JSON.stringify(user));

          checkCorrectInput();
          function checkCorrectInput() {
            let arrUserBirthday = user.userBirthday.split('-');

            if (user.userName === null || user.userName === '') {
              localStorage.removeItem('user');
              alert('Неккоректный ввод имени. Нажмите "OK" и повторите ввод'); 
            }

            if (user.userBirthday.match(/\d{4}-\d{2}-\d{2}/gi) === null ||
                arrUserBirthday[1] < 1 || arrUserBirthday[1] > 12 ||
                arrUserBirthday[2] < 1 || arrUserBirthday[2] > 30) {

              localStorage.removeItem('user');
              alert('Неккоректный ввод даты. Нажмите "OK" и повторите ввод');  
            }
          }
          
          location.reload();
        }

      </script>
  </body> 
</html>