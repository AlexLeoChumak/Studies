<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset=utf-8>
        <title>Practical task â„–21 (ping-pong SVG)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            body {
                padding: 0;
                margin: 0;
                font-family: 'Courier New', Courier, monospace;
                font-size: 30px;
            }
            .container {
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .pong__header {
                display: flex;
                font-size: 40px;
                height: 80px;
                align-items: center;
                padding: 10px 20px;
                background-color: #ffffa5;
                position: relative;
            }
            .pong__btn {
                font-size: 20px;
            }
            .start-btn {
                cursor: pointer;
            }
            .pong__btn-text {
                fill: rgb(69, 66, 66);
                text-anchor: middle;
                pointer-events: none;
            }
            .pong__score {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="pong">
                <div class="pong__header">
                <svg class="pong__btn" width="100" height="50" xmlns="http://www.w3.org/2000/svg">
                    <rect width="80" height="40" fill="white" class="start-btn" />
                    <text x="45" y="25" class="pong__btn-text">GO!</text>
                </svg>
                <div class="pong__score">
                    <span class="player-left">0</span> : <span class="player-right">0</span>
                </div>
                </div>
                <svg class="pong__body" width="700" height="400" xmlns="http://www.w3.org/2000/svg">
                    <rect class="field" fill="#ffe1a8" />
                </svg>
            </div>
        </div>
	    <script>
            "use strict";

            const width = 700;
            const height = 400;
            const gameSize = document.querySelector(".pong__body");
            gameSize.setAttribute("width", width);
            gameSize.setAttribute("height", height);

            const fieldSize = document.querySelector(".field");
            fieldSize.setAttribute("width", width);
            fieldSize.setAttribute("height", height);

            const field = {
                width: parseInt(fieldSize.getAttribute("width")),
                height: parseInt(fieldSize.getAttribute("height")),
            };

            const racketCenterY = field.height / 2;

            class Racket {
                constructor(x, y, width, height, color, selector) {
                    this.x = x;
                    this.y = y;
                    this.speedY = 0;
                    this.width = width;
                    this.height = height;
                    this.color = color;
                    this.selector = selector;
                }
                draw() {
                    const Racket = document.createElementNS("http://www.w3.org/2000/svg","rect");
                    Racket.setAttribute("x", this.x);
                    Racket.setAttribute("y", this.y);
                    Racket.setAttribute("width", this.width);
                    Racket.setAttribute("height", this.height);
                    Racket.setAttribute("fill", this.color);
                    Racket.setAttribute("class", this.selector);
                    gameSize.appendChild(Racket);
                }
                update() {
                    const Racket = document.querySelector(`.${this.selector}`);
                    Racket.setAttribute("y", this.y);

                    if (this.y <= 0) {
                    this.y = 0;
                    }

                    if (this.y + this.speedY + this.height >= field.height) {
                    this.y = field.height - this.height;
                }
            }

            move() {
                this.y += this.speedY;
                this.update();
                }
            }

            const leftRacket = new Racket(
                0,
                racketCenterY - 40,
                20,
                100,
                "red",
                "racket-left"
            );

            const rightRacket = new Racket(
                field.width - 20,
                racketCenterY - 40,
                20,
                100,
                "green",
                "racket-right"
            );

            const ballCenterX = field.width / 2;
            const ballCenterY = field.height / 2;

            let ballSpeed = 5;

            let playerLeft = document.querySelector(".player-left");
            let playerRight = document.querySelector(".player-right");

            class Ball {
                constructor(cx, cy, radius, color, selector) {
                    this.cx = cx;
                    this.cy = cy;
                    this.radius = radius;
                    this.speedX = 0;
                    this.speedY = 0;
                    this.color = color;
                    this.selector = selector;
                }

                loop() {
                    this.cx = ballCenterX;
                    this.cy = ballCenterY;

                    this.speedX = randomDirection();
                    this.speedY = randomDirection();
                }

                draw() {
                    const ball = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    ball.setAttribute("cx", this.cx);
                    ball.setAttribute("cy", this.cy);
                    ball.setAttribute("r", this.radius);
                    ball.setAttribute("fill", this.color);
                    ball.setAttribute("class", this.selector);
                    gameSize.appendChild(ball);
                }

                stop() {
                    this.speedX = 0;
                    this.speedY = 0;
                }

                update() {
                    const ball = document.querySelector(`.${this.selector}`);
                    ball.setAttribute("cx", this.cx);
                    ball.setAttribute("cy", this.cy);

                    this.cx += this.speedX;
                    this.cy += this.speedY;

                    const rightSide = this.cx + this.radius;
                    const leftSide = this.cx + this.speedX - this.radius / 2;
                    const topSide = this.cy;
                    const bottomSide = this.cy + this.radius;

                    if (leftSide <= leftRacket.x + leftRacket.width &&
                        topSide <= leftRacket.y + leftRacket.height &&
                        bottomSide >= leftRacket.y) {

                        this.speedX = -this.speedX;
                    }

                    if (rightSide >= rightRacket.x &&
                        topSide <= rightRacket.y + rightRacket.height &&
                        bottomSide >= rightRacket.y ) {

                        this.speedX = -this.speedX;
                    }

                    if (this.cy - this.radius <= 0) {
                        this.speedY = -this.speedY;
                    }

                    if (this.cy + this.radius + this.speedY >= field.height) {
                        this.speedY = -this.speedY;
                    }

                    if (this.cx + this.radius + this.speedX > field.width) {
                        this.stop();
                        playerLeft.textContent = parseInt(playerLeft.textContent) + 1;
                        if (Number(playerLeft.innerHTML) === 5) {
                            document.body.innerHTML = `<div class="winner">GAME OVER!<br> Winner - the player with the red racket!</div>`;
                            setTimeout(() => {location.reload()}, 5000);
                        }
                        setTimeout(() => start(), 2000);
                    }

                    if (this.cx + this.speedX - this.radius < 0) {
                        this.stop();
                        playerRight.textContent = parseInt(playerRight.textContent) + 1;
                        if (Number(playerRight.innerHTML) === 5) {
                            document.body.innerHTML = `<div class="winner">GAME OVER!<br> Winner - the player with the green racket!</div>`;
                            setTimeout(() => {location.reload()}, 5000);
                        }
                        setTimeout(() => start(), 2000); 
                    }
                }
            }

            function randomDirection() {
                return Math.random() * 1 > 0.5 ? -ballSpeed : ballSpeed;
            }

            const ball = new Ball(ballCenterX, ballCenterY, 10, "rgb(255, 0, 225)", "ball");

            init();

            const startButton = document.querySelector(".start-btn");
            startButton.addEventListener("click", start);
            const startButtonText = document.querySelector(".pong__btn-text");

            addEventListener("keydown", keyDown);
            addEventListener("keyup", keyUp);
            window.addEventListener("load", animate);

            function start() {
                ball.loop();
                startButton.remove();
                startButtonText.remove();
            }

            function init() {
                leftRacket.draw();
                rightRacket.draw();
                ball.draw();
            }

            function animate() {
                leftRacket.move();
                rightRacket.move();
                ball.update();
                requestAnimationFrame(animate);
            }

            function keyDown(e) {
                let paddleSpeed = 4; 
                switch(e.code) { 
                    case 'ControlLeft': leftRacket.speedY = paddleSpeed; break;
                    case 'ShiftLeft': leftRacket.speedY = -paddleSpeed; break;
                    case 'ArrowDown': rightRacket.speedY = paddleSpeed; break;
                    case 'ArrowUp': rightRacket.speedY = -paddleSpeed; break;
                }
            }

            function keyUp(e) {
                let paddleSpeed = 0;
                switch (e.code) { 
                    case 'ControlLeft': leftRacket.speedY = paddleSpeed; break;
                    case 'ShiftLeft': leftRacket.speedY = paddleSpeed; break;
                    case 'ArrowDown': rightRacket.speedY = paddleSpeed; break;
                    case 'ArrowUp': rightRacket.speedY = paddleSpeed; break;
                }
            }

            

        </script>
    </body>
</html>