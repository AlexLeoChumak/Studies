<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset=utf-8>
        <title>Practical task #16 (calendar with selects)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            body {
                font-family: Arial, Helvetica, sans-serif;
            }
            header{
                width: 640px;
                height: 100px;
                margin: 0 auto;
                text-align: center;
            }
            .calendar-with-btns {
                width: 500px;
                height: 500px;
                margin: 10px auto;
                padding: 20px;
            }
            table {
                width: 100%;
                border: 1px solid gray;
                border-radius: 3px;
                border-collapse: collapse;
            }
            td {
                height: 50px;
                width: 50px;
                text-align: center;
                vertical-align: middle;
                border-right: 1px solid gray;
                border-top: 1px solid gray;
            }
            th{
                border-right: 1px solid gray;
                border-top: 1px solid gray;
                height: 50px;
                width: 50px;
            }
            td.otherMon {
                color: #c0c0c0;
            }
            h2 {
                display: inline-block;
                margin: 20px auto;
                width: 45%;
                text-align: center;
            }
            button {
                width: 60px;
                height: 40px;
                transition: .3s linear;
            }
            button:hover {
                border: gray;
                cursor: pointer;
                background-color: rgb(253, 114, 114);
            }
            .btnPrevYear,
            .btnPrevMonth {
                float: left;
                margin-right: 5px;
            }
            .btnNextMonth,
            .btnNextYear {
                float: right;
                margin-left: 5px;
            }
            #create_calendar,
            #delete_calendar{
                width: 100px;
                margin: 10px;
            }
            td:hover{
                background-color: red;
                cursor: pointer;
            }
            .highlight{
                background-color: red;
            }
            select{
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <header>
            <form></form>
        </header>
        <div class="calendar-with-btns">
            <div id="layout"></div>
        </div>
        <script>
            function createSelectMonth(months) {
                let select = document.createElement('select');
                select.setAttribute('id', 'sel1');
                let html = '';
                months = ['Выбрать месяц', 'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];

                months.forEach(function(month, i) {
                    html += `<option value = "${i}">${month}</option>`;
                });
                select.innerHTML = html;
                return select;
            }

            function createSelectYear(year) {
                let select = document.createElement('select');
                select.setAttribute('id', 'sel2');
                let html = '';
                let years = createArrWithYears();

                function createArrWithYears() {
                    let years = [];

                    for (let i = 1980; i < 2022; i++) {
                        years.push(i);
                    }

                    years.unshift('Выбрать год');
                    return years;
                }

                years.forEach(function(year, i) {
                    html += `<option value = ${i}>${year}</option>`;
                });
                select.innerHTML = html;
                return select;
            }

            function createBtnCreate() {
                let btnCreate = document.createElement('button');
                btnCreate.setAttribute('type', 'button');
                btnCreate.setAttribute('id', 'create_calendar');
                btnCreate.setAttribute('disabled','disabled');
                btnCreate.innerHTML = 'Создать';
                return btnCreate;
            }

            function createBtnDelete() {
                let btnDelete = document.createElement('button');
                btnDelete.setAttribute('type', 'button');
                btnDelete.setAttribute('id', 'delete_calendar');
                btnDelete.setAttribute('disabled','disabled');
                btnDelete.innerHTML = 'Удалить';
                return btnDelete;
            }

            const selectM = createSelectMonth();
            const selectY = createSelectYear();
            const btnCreate = createBtnCreate();
            const btnDelete = createBtnDelete();
            const form = document.querySelector('form');
            form.append(selectM, selectY, btnCreate, btnDelete);

            let layout = document.querySelector('#layout');

            function deleteCalendar(e) {
                let tabl = document.querySelector('table');
                if (tabl) {
                    tabl.remove();
                } else {
                     return;
                }
            } 

            function undisabledDelete() {
                btnDelete.removeAttribute('disabled');
            }

            function checkInCalendar() {

                if (layout.hasChildNodes()) {
                    btnDelete.removeAttribute('disabled');
                } else {
                    btnDelete.setAttribute('disabled', 'disabled');
                }
            } 

            function getM() {
                const e = document.getElementById("sel1");
                const value = e.value;
                return value;
            }

            function getY() {
                const e = document.getElementById("sel2");
                const text = e.options[e.selectedIndex].text;
                return text;
            }

            const enableButtonNeeded = function() {
                if (sel1.value !== sel1.children[0].value &&
                    sel2.value !== sel2.children[0].value) {
                    btnCreate.removeAttribute('disabled');
                } else {
                    btnCreate.setAttribute('disabled','disabled');
                }
            }

            sel1.onclick = enableButtonNeeded;
            sel2.onclick = enableButtonNeeded;

            btnCreate.addEventListener('click', getM);
            btnCreate.addEventListener('click', getY);
            btnCreate.addEventListener('click', createCalendar);
            btnCreate.addEventListener('click', undisabledDelete);
            btnDelete.addEventListener('click', deleteCalendar);
            btnDelete.addEventListener('click', checkInCalendar);

            function createCalendar() {
                let month = getM();
                month -= 1;
                let year = Number(getY());

                const weekArr = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
                const monthsArr = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];

                function getTitleCalendar(year, month) {
                    let firstDayMonth = new Date(year, month, 7).getDay();
                    let lastDateMonth =  new Date(year, month + 1, 0).getDate();
                    let lastDayPreviousMonth = month == 0 ? new Date(year-1, 11, 0).getDate() : new Date(year, month, 0).getDate();

                    let pasteLayout = '<table class="red">';
                    pasteLayout += '<thead><tr>';
                    pasteLayout += '<th colspan="7">' + '<button class="btnPrevYear", type="button">' + '<<' + '</button>' + '<button class="btnPrevMonth", type="button">' + '<' + '</button>' + '<h2>' + monthsArr[month] + ' ' + year + '</h2>' + '<button class="btnNextYear", type="button">' + '>>' + '</button>' + '<button class="btnNextMonth", type="button">' + '>' + '</button>' + '</th>';
                    pasteLayout += '</tr></thead>';

                    for (let i = 0; i < weekArr.length; i++) {
                        pasteLayout += '<th>' + weekArr[i] + '</th>';
                    }

                    pasteLayout += '</tr>';

                    let i = 1;
                    do {

                    let dayOnWeek = new Date(year, month, i).getDay();

                    if ( dayOnWeek == 1 ) {
                        pasteLayout += '<tr>';
                    }

                    else if ( i == 1 ) {
                        pasteLayout += '<tr>';
                        let yesterday = lastDayPreviousMonth - firstDayMonth + 1;

                        for (let j = 0; j < firstDayMonth; j++) {
                            pasteLayout += '<td class="otherMon">' + yesterday + '</td>';
                            yesterday++;
                        }
                    }

                    pasteLayout += '<td>' + i + '</td>';

                    if ( dayOnWeek == 0 ) {
                        pasteLayout += '</tr>';
                    }

                    else if ( i == lastDateMonth ) {
                        let yesterday = 1;
                        for (dayOnWeek; dayOnWeek < 7; dayOnWeek++) {
                            pasteLayout += '<td class="otherMon">' + yesterday + '</td>';
                            yesterday++;
                        }
                    }

                    i++;
                    } while (i <= lastDateMonth);

                    pasteLayout += '</table>';

                    layout.insertAdjacentHTML("beforeend", pasteLayout);

                    let calendarArr = document.querySelectorAll('.red'); 

                    for (let element of calendarArr) {
                        element.addEventListener('click', function (event) {
                            let target = event.target;

                            if (target.classList.contains('btnPrevYear')) {
                                prevYear();
                            } else if (target.classList.contains('btnPrevMonth')) {
                                previousMonth();
                            } else if (target.classList.contains('btnNextMonth')) {
                                nextMonth();
                            } else if (target.classList.contains('btnNextYear')) {
                                nextYear();
                            } else if (target.tagName == 'TD') {
                                highlight(target);
                            }
                        });

                    let selectedTd;

                    function highlight(td) {
                        if (selectedTd) {
                            selectedTd.classList.remove('highlight');
                        }
                        selectedTd = td;
                        selectedTd.classList.add('highlight');
                        }
                    }



                    function nextYear() {
                        year += 1;
                        switchMonthYear();
                    }

                    function prevYear() {
                        year -= 1;
                        switchMonthYear();
                    }

                    function nextMonth() {
                        if ( month == 11 ) {
                            month = 0;
                            year += 1;
                        } else {
                            month += 1;
                        }
                        switchMonthYear();
                    }

                    function previousMonth() {
                        if ( month == 0 ) {
                            month = 11;
                            year -= 1;
                        } else {
                            month -= 1;
                        }
                        switchMonthYear();
                    }

                    function switchMonthYear(year, month) {

                        let firstDayMonth = new Date(year, month, 7).getDay();
                        let lastDateMonth =  new Date(year, month + 1, 0).getDate();
                        let lastDayPreviousMonth = month == 0 ? new Date(year-1, 11, 0).getDate() : new Date(year, month, 0).getDate();

                        let pasteLayout = '<table class="red">';
                        pasteLayout += '<thead><tr>';
                        pasteLayout += '<th colspan="7">' + '<button class="btnPrevYear", type="button">' + '<<' + '</button>' + '<button class="btnPrevMonth", type="button">' + '<' + '</button>' + '<h2>' + monthsArr[month] + ' ' + year + '</h2>' + '<button class="btnNextYear", type="button">' + '>>' + '</button>' + '<button class="btnNextMonth", type="button">' + '>' + '</button>' + '</th>';
                        pasteLayout += '</tr></thead>';

                        for (let i = 0; i < weekArr.length; i++) {
                            pasteLayout += '<th>' + weekArr[i] + '</th>';
                        }

                        pasteLayout += '</tr>';

                        let i = 1;
                        do {

                        let dayOnWeek = new Date(year, month, i).getDay();

                        if ( dayOnWeek == 1 ) {
                            pasteLayout += '<tr>';
                        }

                        else if ( i == 1 ) {
                            pasteLayout += '<tr>';
                            let yesterday = lastDayPreviousMonth - firstDayMonth + 1;

                            for (let j = 0; j < firstDayMonth; j++) {
                                pasteLayout += '<td class="otherMon">' + yesterday + '</td>';
                                yesterday++;
                            }
                        }

                        pasteLayout += '<td>' + i + '</td>';

                        if ( dayOnWeek == 0 ) {
                            pasteLayout += '</tr>';
                        }

                        else if ( i == lastDateMonth ) {
                            let yesterday = 1;
                            for (dayOnWeek; dayOnWeek < 7; dayOnWeek++) {
                                pasteLayout += '<td class="otherMon">' + yesterday + '</td>';
                                yesterday++;
                            }
                        }

                        i++;
                        } while (i <= lastDateMonth);

                        pasteLayout += '</table>';

                        const red = document.querySelector('.red');

                        red.innerHTML = pasteLayout;
                    }
                    
                }
                getTitleCalendar(year, month);
            }       
        </script>
    </body> 
</html>