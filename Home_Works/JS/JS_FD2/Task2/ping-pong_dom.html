<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset=utf-8>
        <title>Practical task â„–20 (ping-pong)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            * {
                box-sizing: border-box;
            }
            body {
                font-family: 'Courier New', Courier, monospace;
            }
            .pingPongTable {
                border: 5px solid rgb(190, 190, 190);
                background: url(https://catherineasquithgallery.com/uploads/posts/2021-02/1613123069_17-p-fon-nezhno-zheltii-18.jpg);
            }            
            .startBtn {
                font-size: 28px;
                margin: 10px auto;
                width: 200px;
                height: 60px;
                border: 5px solid rgb(190, 190, 190);
                cursor: pointer;
                transition: .2s;
                font-family: 'Courier New', Courier, monospace;
            }
            .score {
                margin: 10px 0;
                width: 300px;
                font-size: 70px;
                text-align: center;
                border: 5px solid rgb(190, 190, 190);
            }
            .showScore {
                margin: 170px 0;
                width: 700px;
                font-size: 50px;
            }
            .racketLeft {
                width: 10px;
                height: 120px;
                position: absolute;
                background-color: red;
                transform: translateZ(0); 
                will-change: transform;
            }
            .racketRight {
                width: 10px;
                height: 120px;
                position: absolute;
                background-color: green;
                transform: translateZ(0); 
                will-change: transform;
            }
            .ball {
                width: 30px;
                height: 30px;
                position: absolute;
                border-radius: 15px;
                background-color: rgb(255, 0, 225);
                transform: translateZ(0); 
                will-change: transform;
            }
            .winner {
                text-align: center;
                padding: 400px 0 0 0;
                font-size: 30px;
                font-weight: bold;
                background: url(https://usagif.com/wp-content/uploads/fireworks-7.gif) center center no-repeat;
            }
            p {
                text-align: center;
            }
        </style>
    </head>
    <body>
	    <div class="pingPongTable"></div>

	    <script>
            'use strict';

            const pingPongTable = document.querySelector('.pingPongTable');
            pingPongTable.style.width = '800px';
            pingPongTable.style.height = '500px';
            
            let areaH;
            let racketH;
            let ballH;
            const racketLeft = document.createElement('div');
            const racketRight = document.createElement('div');
            racketLeft.classList.add('racketLeft');
            pingPongTable.append(racketLeft);
            racketRight.classList.add('racketRight');
            pingPongTable.append(racketRight);

            const ball = document.createElement('div');
            ball.classList.add('ball');
            pingPongTable.append(ball);

            const score = document.createElement('div');
            let scoreLeft = 0;
            let scoreRight = 0;
            const showScore = document.createElement('div');
            showScore.classList.add('showScore');
            pingPongTable.append(showScore);
            const messageGoalText = 'SCORE';
            score.classList.add('score');
            document.body.append(score);
            
            const startBtn = document.createElement('button');
            startBtn.type = 'button';
            startBtn.textContent = 'START';
            startBtn.classList.add('startBtn');
            document.body.append(startBtn);
            startBtn.addEventListener('click', start);

            showScoreFn();
            requestAnimationFrame(gameMechanics);

            areaH = {
                left: pingPongTable.getBoundingClientRect().left,
                top: pingPongTable.getBoundingClientRect().top,
                width: pingPongTable.getBoundingClientRect().width,
                height: pingPongTable.getBoundingClientRect().height,
            };

            racketH = {
                width: 10,
                height: 120,

                racketASpeed: 0,
                racketAPosX: -5,
                racketAPosY: areaH.height / 2 - 60,
                
                racketBSpeed: 0,
                racketBPosX: areaH.width - 15,
                racketBPosY: areaH.top + areaH.height / 2 - 60,
                
                update: function() {
                    racketLeft.style.transform = `translateX(${this.racketAPosX}px) translateY(${this.racketAPosY}px)`;
                    racketRight.style.transform = `translateX(${this.racketBPosX}px) translateY(${this.racketBPosY}px)`;
                }
            };

            ballH = {
                speedX: 0,
                speedY: 0,
                width: 30,
                height: 30,
                posX: areaH.width / 2 - ball.getBoundingClientRect().width / 2,
                posY: areaH.height / 2 - ball.getBoundingClientRect().height / 2,

                update: function() {
                    ball.style.transform = `translateX(${this.posX}px) translateY(${this.posY}px)`;
                }
            };

            document.addEventListener('keydown', function(e) {
                e.preventDefault();

                switch(e.code) { 
                    case 'ControlLeft': racketH.racketASpeed = 7; break;
                    case 'ShiftLeft': racketH.racketASpeed = -7; break;
                    case 'ArrowDown': racketH.racketBSpeed = 7; break;
                    case 'ArrowUp': racketH.racketBSpeed = -7; break;
                }
            });

            document.addEventListener('keyup', function(e) {
                e.preventDefault();

                switch (e.code) { 
                    case 'ControlLeft': racketH.racketASpeed = 0; break;
                    case 'ShiftLeft': racketH.racketASpeed = 0; break;
                    case 'ArrowDown': racketH.racketBSpeed = 0; break;
                    case 'ArrowUp': racketH.racketBSpeed = 0; break;
                    case 'F5': location.reload(); break;
                }
            });

            function start() {
                ballH.speedX = 9;
                ballH.speedY = Math.round((Math.random() - .5) * 20);
                startBtn.disabled = 'disabled';
                startBtn.style.cursor = 'default';
                
            }

            function showScoreFn() {
                score.innerHTML = `${scoreLeft} : ${scoreRight}`; 
            }

            function gameMechanics() {
                racketH.update();
                ballH.update();

                racketH.racketAPosY += racketH.racketASpeed;
                if (racketH.racketAPosY + racketH.height > (areaH.height - 5)) {
                    racketH.racketAPosY = areaH.height - racketH.height - 5;
                }
                if (racketH.racketAPosY < areaH.top - 12) {
                    racketH.racketAPosY = areaH.top - 12;
                }

                racketH.racketBPosY += racketH.racketBSpeed;
                if (racketH.racketBPosY + racketH.height > (areaH.height - 5)) {
                    racketH.racketBPosY = areaH.height - racketH.height - 5;
                }
                if (racketH.racketBPosY < areaH.top - 12) {
                    racketH.racketBPosY = areaH.top - 12;
                }

                ballH.posX -= ballH.speedX;

                if ((ballH.posY + ballH.height < racketH.racketBPosY || 
                     ballH.posY > (racketH.racketBPosY + racketH.height)) &&
                     ballH.posX + ballH.width >= (areaH.width)) {
                    
                    ballH.speedX = 0;
                    ballH.speedY = 0;
                    scoreLeft++;
                    showScoreFn();
                    showScore.innerHTML = `<p>${messageGoalText} the player with the red racket</p>`;

                    ballH.posX = areaH.width - 40;

                    setTimeout(function() {
                        if (scoreLeft > 4) {
                            score.remove();
                            pingPongTable.innerHTML = `<div class="winner">GAME OVER!<br> Winner - the player with the red racket!</div>`;
                            setTimeout(() => {location.reload()}, 5000);
                        }

                        showScore.innerHTML = '';
                        ballH.posX = areaH.left + racketH.width;
                        ballH.posY = racketH.racketAPosY + racketH.height / 2;
                        start();
                    }, 3000);

                } else if (!(ballH.posY + ballH.height < racketH.racketBPosY || 
                             ballH.posY > (racketH.racketBPosY + racketH.height)) && 
                             ballH.posX + ballH.width > (racketH.racketBPosX)) {
                    
                    ballH.speedX =- ballH.speedX;
                    ballH.posX = areaH.width - racketH.width - ballH.width;
                    
                }

                 //////////////////////////////////////////////////////////////////////

                if ((ballH.posY + ballH.height < racketH.racketAPosY || 
                     ballH.posY > (racketH.racketAPosY + racketH.height)) && 
                     ballH.posX <= -3) {

                    ballH.speedX = 0;
					ballH.speedY = 0;
                    scoreRight++;
					showScoreFn();
					showScore.innerHTML = `<p>${messageGoalText} the player with the green racket</p>`;

                    ballH.posX = 0;

                    setTimeout(function() {
                        if (scoreRight > 4) {
                            score.remove();
                            pingPongTable.innerHTML = `<div class="winner">Game OVER!<br> Winner - the player with the green racket!</div>`;
                            setTimeout(() => {location.reload()}, 5000);
                        }
                        showScore.innerHTML = '';
                        ballH.posX = areaH.left + areaH.width - racketH.width;
                        ballH.posY = racketH.racketBPosY + racketH.height / 2;
                        start();
                    }, 3000);

                } else if (!(ballH.posY + ballH.height < racketH.racketAPosY || 
                             ballH.posY > (racketH.racketAPosY + racketH.height)) &&
                             ballH.posX < (racketH.width + racketH.racketAPosX)) {
                   
                    ballH.speedX = -ballH.speedX;
                    ballH.posX = 5;
                    
                }

                ballH.posY -= ballH.speedY;
                
                if (ballH.posY + ballH.height > areaH.height) {
                    ballH.posY = areaH.height - ballH.height;
                    ballH.speedY = -ballH.speedY;
                }

                if (ballH.posY < 0) {
                    ballH.posY = 0;
                    ballH.speedY = -ballH.speedY;
                    
                }

                requestAnimationFrame(gameMechanics);
            }
        </script>
    </body>
</html>